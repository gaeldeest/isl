open IslRaw
open Isl_Utils
open Isl_Sigs
    
module Make (CTX: CTX): CONSTRAINT with
  type t = IslRaw.constrnt and type value = IslRaw.value and type local_space = IslRaw.local_space
= struct
  open CTX
  type t = constrnt

  let copy = Constraint.copy
  let wrap = wrap Constraint.free

  let equality_alloc s = wrap @@ isl_equality_alloc (LocalSpace.copy s)
  let inequality_alloc s = wrap @@ isl_inequality_alloc (LocalSpace.copy s)
  let set_constant_si c i = wrap @@ Constraint.set_constant_si (copy c) i
  let set_constant_val c v = wrap @@ Constraint.set_constant_val (copy c) (Val.copy v)
  let set_coefficient_si c dim_type pos i = wrap @@ Constraint.set_coefficient_si
      (copy c) (to_isl_dim_type dim_type) pos i
  let set_coefficient_val c dim_type pos v = wrap @@ Constraint.set_coefficient_val
      (copy c) (to_isl_dim_type dim_type) pos (Val.copy v)

  let local_space c = LocalSpace.wrap @@ Constraint.get_local_space c

  let is_lower_bound c dim_type pos = Constraint.is_lower_bound c (to_isl_dim_type dim_type) (Unsigned.UInt.of_int pos)
  let is_upper_bound c dim_type pos = Constraint.is_upper_bound c (to_isl_dim_type dim_type) (Unsigned.UInt.of_int pos)

  let get_constant_val c = Val.wrap @@ Constraint.get_constant_val c
  let get_coefficient_val c dim_type pos = Val.wrap @@ Constraint.get_coefficient_val c (to_isl_dim_type dim_type) pos
  let get_dim_name c dim_type pos = Constraint.get_dim_name c (to_isl_dim_type dim_type) (Unsigned.UInt.of_int pos)

  let get_type c = if Constraint.is_equality c then Equality else Inequality
  let get_div c pos = Aff.wrap @@ Constraint.get_div c pos

  let involves_dims c dim_type ~first ~n = Constraint.involves_dims c (to_isl_dim_type dim_type) (Unsigned.UInt.of_int first) (Unsigned.UInt.of_int n)

end
